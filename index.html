<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScaleBuddy - Music Theory Reference</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
      padding: 40px;
      max-width: 900px;
      width: 100%;
    }

    h1 {
      text-align: center;
      color: #5a67d8;
      margin-bottom: 8px;
      font-size: 2.8em;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .subtitle {
      text-align: center;
      color: #6b7280;
      margin-bottom: 35px;
      font-size: 1em;
      font-weight: 400;
    }

    .input-section {
      background: white;
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
    }

    .dropdowns-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 15px;
    }

    .dropdown-group {
      display: flex;
      flex-direction: column;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #4b5563;
      font-size: 0.95em;
    }

    select {
      padding: 14px 16px;
      font-size: 1.05em;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: inherit;
      font-weight: 500;
      color: #374151;
    }

    select:hover {
      border-color: #a5b4fc;
    }

    select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    /* Subtle highlighting for unselected dropdown */
    select:has(option[value=""]:not(:checked)) {
      border-color: #fbbf24;
      background: #fffbeb;
    }

    select:invalid {
      border-color: #fbbf24;
      background: #fffbeb;
    }

    .error-message {
      color: #dc2626;
      font-size: 0.9em;
      margin-top: 10px;
      padding: 10px 14px;
      background: #fee2e2;
      border-radius: 8px;
      display: none;
      font-weight: 500;
      border-left: 4px solid #dc2626;
    }

    .error-message.show {
      display: block;
    }

    .results-section {
      margin-top: 20px;
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .results-section.show {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .result-card {
      background: white;
      padding: 22px;
      border-radius: 12px;
      margin-bottom: 15px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
      border-left: 5px solid #8b5cf6;
    }

    .result-card h3 {
      color: #6d28d9;
      margin-bottom: 12px;
      font-size: 1.2em;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .result-content {
      color: #374151;
      font-size: 1.05em;
      line-height: 1.8;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-weight: 500;
    }

    .chord-display {
      font-size: 1.8em;
      font-weight: 700;
      color: #4f46e5;
      text-align: center;
      margin-bottom: 20px;
      padding: 15px;
      background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
      border-radius: 12px;
      letter-spacing: 1px;
    }

    .scale-notes {
      font-size: 1.1em;
      font-weight: 600;
      color: #4b5563;
    }

    .chord-list {
      font-size: 0.95em;
      line-height: 2;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .chord-item {
      padding: 4px 0;
      border-bottom: 1px dashed #e5e7eb;
    }

    .chord-item:last-child {
      border-bottom: none;
    }

    .chord-name {
      font-weight: 700;
      color: #8b5cf6;
      margin-right: 8px;
    }

    .chord-notes {
      color: #6b7280;
      font-family: 'Courier New', monospace;
    }

    .loading {
      text-align: center;
      color: #6b7280;
      padding: 20px;
      font-style: italic;
    }

    /* Responsive design */
    @media (max-width: 768px) {
      .container {
        padding: 25px;
        margin: 10px;
      }

      h1 {
        font-size: 2em;
      }

      .dropdowns-container {
        grid-template-columns: 1fr;
        gap: 15px;
      }

      .result-card {
        padding: 18px;
      }

      .chord-display {
        font-size: 1.4em;
      }
    }

    /* Scrollbar styling for long lists */
    .result-content::-webkit-scrollbar {
      width: 8px;
    }

    .result-content::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    .result-content::-webkit-scrollbar-thumb {
      background: #a5b4fc;
      border-radius: 10px;
    }

    .result-content::-webkit-scrollbar-thumb:hover {
      background: #818cf8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>♪ ScaleBuddy</h1>
    <p class="subtitle">Comprehensive Music Theory Reference Tool</p>

    <section class="input-section">
      <div class="dropdowns-container">
        <div class="dropdown-group">
          <label for="root-note">Root Note (Pitch Class):</label>
          <select id="root-note" required>
            <option value="">-- Select Root --</option>
            <option value="C">C</option>
            <option value="C#">C#</option>
            <option value="Db">Db</option>
            <option value="D">D</option>
            <option value="D#">D#</option>
            <option value="Eb">Eb</option>
            <option value="E">E</option>
            <option value="F">F</option>
            <option value="F#">F#</option>
            <option value="Gb">Gb</option>
            <option value="G">G</option>
            <option value="G#">G#</option>
            <option value="Ab">Ab</option>
            <option value="A">A</option>
            <option value="A#">A#</option>
            <option value="Bb">Bb</option>
            <option value="B">B</option>
          </select>
        </div>

        <div class="dropdown-group">
          <label for="scale-type">Scale Type:</label>
          <select id="scale-type" required>
            <option value="">-- Select Scale --</option>
            
            <!-- Diatonic Modes -->
            <optgroup label="Diatonic Modes">
              <option value="major">Major (Ionian)</option>
              <option value="dorian">Dorian</option>
              <option value="phrygian">Phrygian</option>
              <option value="lydian">Lydian</option>
              <option value="mixolydian">Mixolydian</option>
              <option value="minor">Natural Minor (Aeolian)</option>
              <option value="locrian">Locrian</option>
            </optgroup>
            
            <!-- Minor Variants -->
            <optgroup label="Minor Variants">
              <option value="harmonicMinor">Harmonic Minor</option>
              <option value="melodicMinor">Melodic Minor (Ascending)</option>
              <option value="neapolitanMinor">Neapolitan Minor</option>
              <option value="neapolitanMajor">Neapolitan Major</option>
            </optgroup>
            
            <!-- Pentatonic & Blues -->
            <optgroup label="Pentatonic & Blues">
              <option value="majorPentatonic">Major Pentatonic</option>
              <option value="minorPentatonic">Minor Pentatonic</option>
              <option value="blues">Blues Scale</option>
            </optgroup>
            
            <!-- Symmetric Scales -->
            <optgroup label="Symmetric Scales">
              <option value="wholeTone">Whole Tone</option>
              <option value="diminishedHW">Diminished (Half-Whole)</option>
              <option value="diminishedWH">Diminished (Whole-Half)</option>
              <option value="augmented">Augmented</option>
              <option value="tritone">Tritone</option>
            </optgroup>
            
            <!-- Jazz & Contemporary -->
            <optgroup label="Jazz & Contemporary">
              <option value="majorBebop">Major Bebop</option>
              <option value="minorBebop">Minor Bebop</option>
              <option value="dominantBebop">Dominant Bebop</option>
              <option value="prometheus">Prometheus</option>
              <option value="enigmatic">Enigmatic</option>
            </optgroup>
            
            <!-- Gypsy & Eastern European -->
            <optgroup label="Gypsy & Eastern European">
              <option value="hungarianMinor">Hungarian Minor</option>
              <option value="hungarianGypsy">Hungarian Gypsy</option>
              <option value="doubleHarmonic">Double Harmonic (Gypsy)</option>
              <option value="phrygianDominant">Phrygian Dominant</option>
            </optgroup>
            
            <!-- World & Exotic -->
            <optgroup label="World & Exotic">
              <option value="balinese">Balinese</option>
              <option value="japanese">Japanese (In Sen)</option>
              <option value="hirajoshi">Hirajoshi</option>
              <option value="iwato">Iwato</option>
              <option value="yo">Yo</option>
              <option value="chinese">Chinese</option>
              <option value="mongolian">Mongolian</option>
              <option value="persian">Persian</option>
              <option value="arabian">Arabian</option>
              <option value="byzantine">Byzantine</option>
              <option value="oriental">Oriental</option>
            </optgroup>
            
            <!-- Chromatic -->
            <optgroup label="Chromatic">
              <option value="chromatic">Chromatic</option>
            </optgroup>
          </select>
        </div>
      </div>

      <div id="error-message" class="error-message"></div>
    </section>

    <section id="results-section" class="results-section">
      <div class="chord-display" id="chord-display"></div>

      <div class="result-card">
        <h3>Scale Notes</h3>
        <div class="result-content scale-notes" id="scale-result">â€”</div>
      </div>

      <div class="result-card">        <h3>Scale Triads</h3>
        <div class="result-content chord-list" id="triads-result">—</div>
      </div>

      <div class="result-card">        <h3>Scale Chords</h3>
        <div class="result-content chord-list" id="chords-result">â€”</div>
      </div>
    </section>
  </div>

  <script>
    // ============================================
    // 1. MUSIC DATA - Comprehensive Scales & Chords
    // ============================================
    
    const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    
    const SCALE_DEGREES = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
    
    const ENHARMONIC_EQUIVALENTS = {
      'Db': 'C#',
      'Eb': 'D#',
      'Gb': 'F#',
      'Ab': 'G#',
      'Bb': 'A#'
    };

    // W/H interval patterns for scales (W = whole step = 2 semitones, H = half step = 1 semitone)
    const SCALE_PATTERNS = {
      // Diatonic Scales
      major: ['W', 'W', 'H', 'W', 'W', 'W', 'H'],
      minor: ['W', 'H', 'W', 'W', 'H', 'W', 'W'],
      harmonicMinor: ['W', 'H', 'W', 'W', 'H', 'W', 'H'],
      melodicMinor: ['W', 'H', 'W', 'W', 'W', 'W', 'H'],
      dorian: ['W', 'H', 'W', 'W', 'W', 'H', 'W'],
      phrygian: ['H', 'W', 'W', 'W', 'H', 'W', 'W'],
      lydian: ['W', 'W', 'W', 'H', 'W', 'W', 'H'],
      mixolydian: ['W', 'W', 'H', 'W', 'W', 'H', 'W'],
      locrian: ['H', 'W', 'W', 'H', 'W', 'W', 'W'],
      
      // Pentatonic Scales
      majorPentatonic: ['W', 'W', '3H', 'W', '3H'],
      minorPentatonic: ['3H', 'W', 'W', '3H', 'W'],
      blues: ['3H', 'W', 'H', 'H', '3H', 'W'],
      
      // Whole Tone & Diminished
      wholeTone: ['W', 'W', 'W', 'W', 'W', 'W'],
      diminishedHW: ['H', 'W', 'H', 'W', 'H', 'W', 'H', 'W'],
      diminishedWH: ['W', 'H', 'W', 'H', 'W', 'H', 'W', 'H'],
      
      // Exotic/World Scales
      hungarianMinor: ['W', 'H', '3H', 'H', 'H', '3H', 'H'],
      doubleHarmonic: ['H', '3H', 'H', 'W', 'H', '3H', 'H'],
      phrygianDominant: ['H', '3H', 'H', 'W', 'H', 'W', 'W'],
      neapolitanMinor: ['H', 'W', 'W', 'W', 'H', '3H', 'H'],
      neapolitanMajor: ['H', 'W', 'W', 'W', 'W', 'W', 'H'],
      enigmatic: ['H', '3H', 'W', 'W', 'W', 'H', 'H'],
      augmented: ['3H', 'H', '3H', 'H', '3H', 'H'],
      prometheus: ['W', 'W', 'W', '3H', 'H', 'W'],
      tritone: ['H', '3H', 'W', 'H', '3H', 'W'],
      balinese: ['H', '4H', 'W', 'H', '4H'],
      japanese: ['H', '4H', 'W', '3H', 'W'],
      hirajoshi: ['4H', 'W', 'H', '3H', 'H'],
      iwato: ['H', '4H', 'H', '4H', 'W'],
      yo: ['W', '3H', 'W', 'W', '3H'],
      chinese: ['W', 'W', '3H', 'W', '3H'],
      mongolian: ['W', 'W', '3H', 'W', '3H'],
      persian: ['H', '3H', 'H', 'H', 'W', '3H', 'H'],
      arabian: ['W', 'H', 'W', 'H', 'W', 'H', 'W'],
      byzantine: ['H', '3H', 'H', 'W', 'H', '3H', 'H'],
      hungarianGypsy: ['W', 'H', '3H', 'H', 'H', '3H', 'H'],
      oriental: ['H', '3H', 'H', 'H', 'W', '3H', 'W'],
      majorBebop: ['W', 'W', 'H', 'W', 'H', 'H', 'W', 'H'],
      minorBebop: ['W', 'H', 'W', 'W', 'H', 'H', 'W', 'H'],
      dominantBebop: ['W', 'W', 'H', 'W', 'W', 'H', 'H', 'W'],
      chromatic: ['H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H', 'H']
    };

    // Scale names for display
    const SCALE_NAMES = {
      major: 'Major (Ionian)',
      minor: 'Natural Minor (Aeolian)',
      harmonicMinor: 'Harmonic Minor',
      melodicMinor: 'Melodic Minor (Ascending)',
      dorian: 'Dorian',
      phrygian: 'Phrygian',
      lydian: 'Lydian',
      mixolydian: 'Mixolydian',
      locrian: 'Locrian',
      majorPentatonic: 'Major Pentatonic',
      minorPentatonic: 'Minor Pentatonic',
      blues: 'Blues Scale',
      wholeTone: 'Whole Tone',
      diminishedHW: 'Diminished (Half-Whole)',
      diminishedWH: 'Diminished (Whole-Half)',
      hungarianMinor: 'Hungarian Minor',
      doubleHarmonic: 'Double Harmonic (Gypsy)',
      phrygianDominant: 'Phrygian Dominant',
      neapolitanMinor: 'Neapolitan Minor',
      neapolitanMajor: 'Neapolitan Major',
      enigmatic: 'Enigmatic',
      augmented: 'Augmented',
      prometheus: 'Prometheus',
      tritone: 'Tritone',
      balinese: 'Balinese',
      japanese: 'Japanese (In Sen)',
      hirajoshi: 'Hirajoshi',
      iwato: 'Iwato',
      yo: 'Yo',
      chinese: 'Chinese',
      mongolian: 'Mongolian',
      persian: 'Persian',
      arabian: 'Arabian',
      byzantine: 'Byzantine',
      hungarianGypsy: 'Hungarian Gypsy',
      oriental: 'Oriental',
      majorBebop: 'Major Bebop',
      minorBebop: 'Minor Bebop',
      dominantBebop: 'Dominant Bebop',
      chromatic: 'Chromatic'
    };

    // Scale degree chord formulas (for each scale type)
    // These define the chord quality for each degree of the scale
    const SCALE_DEGREE_CHORDS = {
      major: ['Major', 'Minor', 'Minor', 'Major', 'Major', 'Minor', 'Diminished'],
      minor: ['Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major'],
      harmonicMinor: ['Minor', 'Diminished', 'Augmented', 'Minor', 'Major', 'Major', 'Diminished'],
      melodicMinor: ['Minor', 'Minor', 'Augmented', 'Major', 'Major', 'Diminished', 'Diminished'],
      dorian: ['Minor', 'Minor', 'Major', 'Major', 'Minor', 'Diminished', 'Major'],
      phrygian: ['Minor', 'Major', 'Major', 'Minor', 'Diminished', 'Major', 'Minor'],
      lydian: ['Major', 'Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Minor'],
      mixolydian: ['Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major'],
      locrian: ['Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major', 'Minor'],
      majorPentatonic: ['Major', 'Minor', 'Minor', 'Major', 'Minor'],
      minorPentatonic: ['Minor', 'Major', 'Minor', 'Minor', 'Major'],
      blues: ['Minor', 'Major', 'Minor', 'Diminished', 'Minor', 'Major'],
      wholeTone: ['Augmented', 'Augmented', 'Augmented', 'Augmented', 'Augmented', 'Augmented'],
      diminishedHW: ['Diminished', 'Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Diminished', 'Major'],
      diminishedWH: ['Diminished', 'Minor', 'Major', 'Diminished', 'Minor', 'Major', 'Diminished', 'Minor'],
      hungarianMinor: ['Minor', 'Diminished', 'Augmented', 'Minor', 'Major', 'Major', 'Diminished'],
      doubleHarmonic: ['Minor', 'Major', 'Minor', 'Minor', 'Major', 'Diminished', 'Major'],
      phrygianDominant: ['Minor', 'Major', 'Minor', 'Minor', 'Major', 'Diminished', 'Major'],
      neapolitanMinor: ['Minor', 'Major', 'Minor', 'Minor', 'Major', 'Diminished', 'Major'],
      neapolitanMajor: ['Minor', 'Major', 'Minor', 'Minor', 'Major', 'Diminished', 'Major'],
      enigmatic: ['Minor', 'Major', 'Augmented', 'Diminished', 'Minor', 'Major', 'Major'],
      augmented: ['Minor', 'Augmented', 'Minor', 'Augmented', 'Minor', 'Augmented'],
      prometheus: ['Major', 'Major', 'Minor', 'Diminished', 'Minor', 'Major'],
      tritone: ['Minor', 'Major', 'Minor', 'Diminished', 'Minor', 'Major'],
      balinese: ['Minor', 'Major', 'Minor', 'Minor', 'Major'],
      japanese: ['Minor', 'Major', 'Minor', 'Minor', 'Major'],
      hirajoshi: ['Minor', 'Major', 'Diminished', 'Minor', 'Major'],
      iwato: ['Minor', 'Major', 'Minor', 'Minor', 'Major'],
      yo: ['Major', 'Minor', 'Major', 'Major', 'Minor'],
      chinese: ['Major', 'Minor', 'Major', 'Major', 'Minor'],
      mongolian: ['Major', 'Minor', 'Major', 'Major', 'Minor'],
      persian: ['Minor', 'Major', 'Minor', 'Diminished', 'Minor', 'Major', 'Major'],
      arabian: ['Minor', 'Diminished', 'Major', 'Minor', 'Diminished', 'Major', 'Major'],
      byzantine: ['Minor', 'Major', 'Minor', 'Minor', 'Major', 'Diminished', 'Major'],
      hungarianGypsy: ['Minor', 'Diminished', 'Augmented', 'Minor', 'Major', 'Major', 'Diminished'],
      oriental: ['Minor', 'Major', 'Minor', 'Diminished', 'Minor', 'Major', 'Major'],
      majorBebop: ['Major', 'Minor', 'Minor', 'Major', 'Major', 'Minor', 'Diminished', 'Major'],
      minorBebop: ['Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major', 'Diminished'],
      dominantBebop: ['Major', 'Minor', 'Diminished', 'Major', 'Minor', 'Minor', 'Major', 'Major'],
      chromatic: ['Minor', 'Major', 'Minor', 'Major', 'Minor', 'Major', 'Minor', 'Major', 'Minor', 'Major', 'Minor', 'Major']
    };

    // Roman numeral patterns for each scale type
    const ROMAN_NUMERALS = {
      major: ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'vii°'],
      minor: ['i', 'ii°', 'III', 'iv', 'v', 'VI', 'VII'],
      harmonicMinor: ['i', 'ii°', 'III+', 'iv', 'V', 'VI', 'vii°'],
      melodicMinor: ['i', 'ii', 'III+', 'IV', 'V', 'vi°', 'vii°'],
      dorian: ['i', 'ii', 'III', 'IV', 'v', 'vi°', 'VII'],
      phrygian: ['i', '♭II', 'III', 'iv', 'v', '♭VI', '♭VII'],
      lydian: ['I', 'II', 'III', '♯IV', 'V', 'vi', 'vii'],
      mixolydian: ['I', 'ii', 'iii', 'IV', 'v', 'vi', '♭VII'],
      locrian: ['i°', '♭II', '♭III', 'iv', '♭V', '♭VI', '♭VII'],
      majorPentatonic: ['I', 'ii', 'iii', 'V', 'vi'],
      minorPentatonic: ['i', '♭III', 'iv', 'v', '♭VII'],
      blues: ['i', '♭III', 'iv', '♭v', 'v', '♭VII'],
      wholeTone: ['I', 'II', 'III', '♯IV', '♯V', '♯VI'],
      diminishedHW: ['i°', '♭II', '♭III', 'iii°', '♯IV', 'v', 'VI', '♭VII'],
      diminishedWH: ['i°', '♭II', '♭III', 'iii°', '♯IV', 'v', 'VI', '♭VII'],
      hungarianMinor: ['i', 'ii°', '♭III', '♯iv', 'v', '♭VI', 'VII'],
      doubleHarmonic: ['i', '♭II', 'III', 'iv', 'v', '♭VI', 'VII'],
      phrygianDominant: ['i', '♭II', 'III', 'iv', 'v', '♭VI', '♭VII'],
      neapolitanMinor: ['i', '♭II', '♭III', 'iv', 'v', '♭VI', 'VII'],
      neapolitanMajor: ['i', '♭II', '♭III', 'iv', 'v', '♭VI', 'VII'],
      enigmatic: ['i', '♭II', 'III', '♯IV', '♯V', '♯VI', 'VII'],
      augmented: ['i', '♭III', 'III', 'v', '♯v', 'VII'],
      prometheus: ['I', 'II', 'III', '♯IV', 'VI', '♭VII'],
      tritone: ['i', '♭II', 'III', '♭v', 'v', '♭VII'],
      balinese: ['i', '♭II', 'IV', 'v', '♭VI'],
      japanese: ['i', '♭II', 'IV', 'v', '♭VII'],
      hirajoshi: ['i', 'III', '♯IV', 'v', 'VII'],
      iwato: ['i', '♭II', 'IV', '♭v', '♭VII'],
      yo: ['I', 'II', 'IV', 'V', 'VI'],
      chinese: ['I', 'II', 'III', 'V', 'VI'],
      mongolian: ['I', 'II', 'III', 'V', 'VI'],
      persian: ['i', '♭II', 'III', 'iv', '♭v', '♭VI', 'VII'],
      arabian: ['i', 'ii°', '♭III', 'iv', '♭v', '♭VI', '♭VII'],
      byzantine: ['i', '♭II', 'III', 'iv', 'v', '♭VI', 'VII'],
      hungarianGypsy: ['i', 'ii°', '♭III', '♯iv', 'v', '♭VI', 'VII'],
      oriental: ['i', '♭II', 'III', 'iv', '♭v', 'VI', '♭VII'],
      majorBebop: ['I', 'ii', 'iii', 'IV', 'V', '♭VI', 'VI', 'VII'],
      minorBebop: ['i', 'ii°', '♭III', 'iv', 'v', '♭VI', 'VI', 'VII'],
      dominantBebop: ['I', 'ii', 'iii', 'IV', 'V', 'vi', '♭VII', 'VII'],
      chromatic: ['i', '♭II', 'II', '♭III', 'III', 'IV', '♯IV', 'V', '♯V', 'VI', '♯VI', 'VII']
    };

    // Chord function names for each scale type
    const CHORD_FUNCTIONS = {
      major: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      minor: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      harmonicMinor: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      melodicMinor: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      dorian: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      phrygian: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      lydian: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      mixolydian: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      locrian: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      majorPentatonic: ['Tonic', 'Supertonic', 'Mediant', 'Dominant', 'Submediant'],
      minorPentatonic: ['Tonic', 'Mediant', 'Subdominant', 'Dominant', 'Subtonic'],
      blues: ['Tonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      wholeTone: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant'],
      diminishedHW: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic', 'Leading Tone'],
      diminishedWH: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic', 'Leading Tone'],
      hungarianMinor: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      doubleHarmonic: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      phrygianDominant: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      neapolitanMinor: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      neapolitanMajor: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      enigmatic: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      augmented: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant'],
      prometheus: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Submediant', 'Subtonic'],
      tritone: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Subtonic'],
      balinese: ['Tonic', 'Supertonic', 'Subdominant', 'Dominant', 'Submediant'],
      japanese: ['Tonic', 'Supertonic', 'Subdominant', 'Dominant', 'Subtonic'],
      hirajoshi: ['Tonic', 'Mediant', 'Subdominant', 'Dominant', 'Leading Tone'],
      iwato: ['Tonic', 'Supertonic', 'Subdominant', 'Dominant', 'Subtonic'],
      yo: ['Tonic', 'Supertonic', 'Subdominant', 'Dominant', 'Submediant'],
      chinese: ['Tonic', 'Supertonic', 'Mediant', 'Dominant', 'Submediant'],
      mongolian: ['Tonic', 'Supertonic', 'Mediant', 'Dominant', 'Submediant'],
      persian: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      arabian: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      byzantine: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      hungarianGypsy: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone'],
      oriental: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic'],
      majorBebop: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone', 'Chromatic'],
      minorBebop: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone', 'Chromatic'],
      dominantBebop: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Subtonic', 'Leading Tone'],
      chromatic: ['Tonic', 'Supertonic', 'Mediant', 'Subdominant', 'Dominant', 'Submediant', 'Leading Tone', 'Chromatic', 'Chromatic', 'Chromatic', 'Chromatic', 'Chromatic']
    };

    // Essential chord definitions (semitones from root)
    // Organized by category for easier navigation
    const CHORDS = {
      // Basic Triads
      'Major': [0, 4, 7],
      'Minor': [0, 3, 7],
      'Diminished': [0, 3, 6],
      'Augmented': [0, 4, 8],
      'Suspended 2nd': [0, 2, 7],
      'Suspended 4th': [0, 5, 7],
      'Power (5th)': [0, 7],
      
      // Sixth Chords
      'Major 6th': [0, 4, 7, 9],
      'Minor 6th': [0, 3, 7, 9],
      '6/9': [0, 4, 7, 9, 14],
      
      // Seventh Chords
      'Major 7th': [0, 4, 7, 11],
      'Dominant 7th': [0, 4, 7, 10],
      'Minor 7th': [0, 3, 7, 10],
      'Minor Major 7th': [0, 3, 7, 11],
      'Half-Diminished (m7b5)': [0, 3, 6, 10],
      'Fully Diminished 7th': [0, 3, 6, 9],
      '7(b5)': [0, 4, 6, 10],
      '7(#5)': [0, 4, 8, 10],
      '7(b9)': [0, 4, 7, 10, 13],
      '7(#9)': [0, 4, 7, 10, 15],
      '7sus4': [0, 5, 7, 10],
      
      // Extended Chords
      '9th': [0, 4, 7, 10, 14],
      'Major 9th': [0, 4, 7, 11, 14],
      'Minor 9th': [0, 3, 7, 10, 14],
      '11th': [0, 4, 7, 10, 14, 17],
      'Minor 11th': [0, 3, 7, 10, 14, 17],
      '13th': [0, 4, 7, 10, 14, 17, 21],
      'Minor 13th': [0, 3, 7, 10, 14, 17, 21],
      
      // Added Tone Chords
      'add2': [0, 2, 4, 7],
      'add4': [0, 4, 5, 7],
      'add9': [0, 4, 7, 14],
      'add11': [0, 4, 7, 17],
      'add13': [0, 4, 7, 21],
      
      // Suspended Chords
      'sus2': [0, 2, 7],
      'sus4': [0, 5, 7],
      '7sus2': [0, 2, 7, 10],
      '7sus4': [0, 5, 7, 10],
      
      // Altered Chords
      'Altered (7alt)': [0, 4, 7, 10, 13, 15, 18],
      
      // Special/Classical Chords
      'Neapolitan (N6)': [0, 3, 7],
      'Italian 6th': [0, 4, 10],
      'French 6th': [0, 4, 9, 10],
      'German 6th': [0, 4, 10, 3],
      'Augmented Major 7': [0, 4, 8, 11],
    };

    // ============================================
    // 2. MUSIC LOGIC
    // ============================================

    function getNoteIndex(note) {
      // Support explicit flats (Db, Eb, Gb, Ab, Bb) by mapping to their enharmonic sharps
      const direct = NOTES.indexOf(note);
      if (direct !== -1) return direct;
      if (ENHARMONIC_EQUIVALENTS[note]) {
        return NOTES.indexOf(ENHARMONIC_EQUIVALENTS[note]);
      }
      return -1;
    }

    // Convert W/H pattern to semitone intervals
    function patternToSemitones(pattern) {
      const semitones = [0]; // Start with root note at 0 semitones
      let current = 0;
      
      for (const step of pattern) {
        if (step === 'H') {
          current += 1;
        } else if (step === 'W') {
          current += 2;
        } else if (step === '3H') {
          current += 3;
        } else if (step === '4H') {
          current += 4;
        } else if (step === '5H') {
          current += 5;
        }
        semitones.push(current);
      }
      
      // Remove the last element (octave) and return scale degrees
      return semitones.slice(0, -1);
    }

    // Get scale notes with proper enharmonic spelling
    function getScaleNotes(rootNote, scaleType) {
      const pattern = SCALE_PATTERNS[scaleType];
      if (!pattern) return [];
      
      const semitones = patternToSemitones(pattern);
      const rootIndex = getNoteIndex(rootNote);
      
      // Get the base note name (without accidental)
      const baseNote = rootNote.replace(/#|b/g, '');
      const baseIndex = SCALE_DEGREES.indexOf(baseNote);
      
      const scaleNotes = [];
      
      for (let i = 0; i < semitones.length; i++) {
        const targetSemitone = (rootIndex + semitones[i]) % 12;
        
        // Get the scale degree name (C, D, E, F, G, A, B)
        const degreeName = SCALE_DEGREES[(baseIndex + i) % 7];
        
        // Find the natural note position
        const degreeNaturalIndex = NOTES.indexOf(degreeName);
        
        // Calculate how many semitones from the natural note to reach the target
        const semitonesToTarget = (targetSemitone - degreeNaturalIndex + 12) % 12;
        
        let noteToUse = degreeName;
        if (semitonesToTarget === 0) {
          noteToUse = degreeName;
        } else if (semitonesToTarget === 1) {
          noteToUse = degreeName + '#';
        } else if (semitonesToTarget === 11) {
          noteToUse = degreeName + 'b';
        }
        
        scaleNotes.push(noteToUse);
      }
      
      return scaleNotes;
    }

    function getChordNotes(rootNote, chordIntervals, parentScale) {
      const notes = chordIntervals.map(interval => {
        const semitone = (getNoteIndex(rootNote) + interval) % 12;
        return NOTES[semitone];
      });
      
      // Apply enharmonic spelling based on parent scale
      return applyEnharmonicSpelling(notes, parentScale);
    }

    function applyEnharmonicSpelling(notes, parentScale) {
      // Maps note names to their degree in the parent scale
      const degreeMap = new Map();
      for (let i = 0; i < parentScale.length; i++) {
        const baseName = parentScale[i].replace(/#|b/g, '');
        degreeMap.set(baseName, parentScale[i]);
      }
      
      return notes.map(note => {
        const baseName = note.replace(/#|b/g, '');
        // Only apply enharmonic spelling if the base name is in the scale
        // AND the scale's spelling matches the note's spelling
        if (degreeMap.has(baseName)) {
          const scaleSpelling = degreeMap.get(baseName);
          // If the note has an accidental, check if it matches the scale spelling
          if (note.includes('#') || note.includes('b')) {
            // Note has accidental, keep it (don't replace G# with G)
            return note;
          }
          // Note has no accidental, use scale spelling
          return scaleSpelling;
        }
        // Base name not in scale, check if it's an enharmonic equivalent
        // For example, D# should become Eb if Eb is in the scale
        const enharmonicMap = {
          'C#': 'Db',
          'D#': 'Eb',
          'F#': 'Gb',
          'G#': 'Ab',
          'A#': 'Bb'
        };
        
        // Check if the enharmonic equivalent is in the scale
        const enharmonicEquivalent = enharmonicMap[note];
        if (enharmonicEquivalent) {
          const enharmonicBase = enharmonicEquivalent.replace(/#|b/g, '');
          if (degreeMap.has(enharmonicBase)) {
            return enharmonicEquivalent;
          }
        }
        
        // Base name not in scale, keep original
        return note;
      });
    }

    function getAllChordsForScale(rootNote, scaleType) {
      const parentScale = getScaleNotes(rootNote, scaleType);
      const chords = [];
      
      for (const [chordName, chordIntervals] of Object.entries(CHORDS)) {
        const chordNotes = getChordNotes(rootNote, chordIntervals, parentScale);
        chords.push({
          name: chordName,
          notes: chordNotes
        });
      }
      
      // Sort alphabetically by chord name
      chords.sort((a, b) => a.name.localeCompare(b.name));
      
      return chords;
    }

    // Get triads for each scale degree with Roman numeral analysis
    function getScaleTriads(rootNote, scaleType) {
      const scaleNotes = getScaleNotes(rootNote, scaleType);
      const triads = [];
      
      // Get the chord qualities for each degree
      const chordQualities = SCALE_DEGREE_CHORDS[scaleType] || [];
      const romanNumerals = ROMAN_NUMERALS[scaleType] || [];
      
      for (let i = 0; i < scaleNotes.length; i++) {
        const degreeRoot = scaleNotes[i];
        
        // Build triad (root, 3rd, 5th) using scale notes
        const thirdDegree = (i + 2) % scaleNotes.length;
        const fifthDegree = (i + 4) % scaleNotes.length;
        
        const triadNotes = [
          degreeRoot,
          scaleNotes[thirdDegree],
          scaleNotes[fifthDegree]
        ];
        
        // Get chord quality from formula
        const chordQuality = chordQualities[i] || 'Unknown';
        
        // Get Roman numeral
        const romanNumeral = romanNumerals[i] || (i + 1).toString();
        
        triads.push({
          degree: i + 1,
          romanNumeral: romanNumeral,
          notes: triadNotes,
          quality: chordQuality,
          chordName: chordQuality,
          rootNote: degreeRoot
        });
      }
      
      return triads;
    }

    // ============================================
    // 3. UI LOGIC
    // ============================================

    function updateDisplay() {
      const rootNote = document.getElementById('root-note').value;
      const scaleType = document.getElementById('scale-type').value;
      const errorDiv = document.getElementById('error-message');
      const resultsSection = document.getElementById('results-section');

      // Clear error
      errorDiv.textContent = '';
      errorDiv.classList.remove('show');

      // Hide results if either dropdown is empty
      if (!rootNote || !scaleType) {
        resultsSection.classList.remove('show');
        
        // Highlight unselected dropdowns
        const rootSelect = document.getElementById('root-note');
        const scaleSelect = document.getElementById('scale-type');
        
        if (!rootNote && rootSelect.value === '') {
          rootSelect.style.borderColor = '#fbbf24';
          rootSelect.style.background = '#fffbeb';
        } else {
          rootSelect.style.borderColor = '';
          rootSelect.style.background = '';
        }
        
        if (!scaleType && scaleSelect.value === '') {
          scaleSelect.style.borderColor = '#fbbf24';
          scaleSelect.style.background = '#fffbeb';
        } else {
          scaleSelect.style.borderColor = '';
          scaleSelect.style.background = '';
        }
        
        return;
      }

      // Clear highlighting
      document.getElementById('root-note').style.borderColor = '';
      document.getElementById('root-note').style.background = '';
      document.getElementById('scale-type').style.borderColor = '';
      document.getElementById('scale-type').style.background = '';

      // Validate scale type
      if (!SCALE_PATTERNS[scaleType]) {
        errorDiv.textContent = 'Invalid scale type selected.';
        errorDiv.classList.add('show');
        return;
      }

      // Calculate scale notes
      const scaleNotes = getScaleNotes(rootNote, scaleType);
      
      // Calculate triads for each scale degree
      const triads = getScaleTriads(rootNote, scaleType);
      
      // Calculate all chords for this scale
      const chords = getAllChordsForScale(rootNote, scaleType);

      // Render results
      const scaleName = SCALE_NAMES[scaleType];
      document.getElementById('chord-display').textContent = `${rootNote} ${scaleName}`;
      
      // Get Roman numerals and chord functions from our new data structures
      const romanNumerals = ROMAN_NUMERALS[scaleType] || [];
      const chordFunctions = CHORD_FUNCTIONS[scaleType] || [];
      
      // Render chord functions for each scale degree (for reference)
      const chordFunctionsHTML = scaleNotes.map((note, index) => {
        const functionText = chordFunctions[index] || 'Scale Degree';
        return `<span class="chord-name">${note}</span> <span class="chord-notes">${functionText}</span>`;
      }).join('\n');
      
      // Render: Table with notes and Roman numerals
      let tableHTML = '<table style="border-collapse: collapse; margin: 10px 0;">';
      tableHTML += '<tr>';
      for (let i = 0; i < scaleNotes.length; i++) {
        tableHTML += `<td style="border: 1px solid #e5e7eb; padding: 8px 12px; text-align: center; min-width: 50px;">`;
        tableHTML += `<span class="chord-name" style="font-family: 'Courier New', monospace;">${scaleNotes[i]}</span>`;
        tableHTML += `</td>`;
      }
      tableHTML += '</tr><tr>';
      for (let i = 0; i < romanNumerals.length; i++) {
        tableHTML += `<td style="border: 1px solid #e5e7eb; padding: 8px 12px; text-align: center; min-width: 50px;">`;
        tableHTML += `<span class="chord-notes" style="font-family: 'Courier New', monospace;">${romanNumerals[i]}</span>`;
        tableHTML += `</td>`;
      }
      tableHTML += '</tr></table>';
      
      // Render: Table (notes + Roman numerals), then chord functions
      document.getElementById('scale-result').innerHTML = tableHTML + chordFunctionsHTML;

      // Render triads (compact format: I C - E - G (C Major), then empty line, then ii D - F - A (D Minor), etc.)
      const triadsHTML = triads.map(triad => {
        return `<span class="chord-name">${triad.romanNumeral}</span> <span class="chord-notes">${triad.notes.join(' - ')} (${triad.rootNote} ${triad.chordName})</span>`;
      }).join('\n\n');
      
      document.getElementById('triads-result').innerHTML = triadsHTML;

      // Render chord list (compact format: C11th C - E - G - A - D - F, then empty line, then next chord)
      const chordsHTML = chords.map(chord => {
        return `<span class="chord-name">${rootNote}${chord.name}</span> <span class="chord-notes">${chord.notes.join(' - ')}</span>`;
      }).join('\n\n');
      
      document.getElementById('chords-result').innerHTML = chordsHTML;

      // Show results
      resultsSection.classList.add('show');
    }

    // ============================================
    // 4. EVENT HANDLERS
    // ============================================

    document.addEventListener('DOMContentLoaded', () => {
      // Auto-update on dropdown changes
      document.getElementById('root-note').addEventListener('change', updateDisplay);
      document.getElementById('scale-type').addEventListener('change', updateDisplay);

      // Focus first dropdown on load
      document.getElementById('root-note').focus();
    });
  </script>
</body>
</html>
